<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>è»Šæƒå³æ™‚ä½ç½®ï½œæ´»å‹•å°šæœªé–‹å§‹</title>
  <style>
    :root {
      --bg: #0b1220;
      --card: #121a2b;
      --text: #ecf2ff;
      --muted: #9fb0d9;
      --accent: #4cc9f0;
      --accent2: #b5179e;
      --ok: #22c55e;
      --warn: #f59e0b;
    }
    html, body { height: 100%; overflow-x: hidden; }
    body {
      margin: 0; font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Noto Sans", "PingFang TC", "Hiragino Sans", Arial, "Apple Color Emoji", "Segoe UI Emoji";
      background: radial-gradient(1200px 800px at 10% 10%, #111a30 0%, #0b1220 60%),
                  radial-gradient(800px 600px at 90% 20%, #16223a 0%, #0b1220 70%),
                  #0b1220;
      color: var(--text);
      display: grid; place-items: center;
    }
    .wrap { width: min(960px, 92vw); padding: 24px; }
    .card {
      background: linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.02));
      border: 1px solid rgba(255,255,255,0.12);
      border-radius: 20px; padding: 24px; box-shadow: 0 10px 30px rgba(0,0,0,0.25);
    }
    h1 { font-size: clamp(22px, 3vw, 32px); margin: 0 0 6px; letter-spacing: 0.5px; }
    .subtitle { color: var(--muted); font-size: 14px; margin-bottom: 16px; }
    .grid { display: grid; grid-template-columns: 1.2fr 1fr; gap: 20px; }
    @media (max-width: 860px) { .grid { grid-template-columns: 1fr; } }

    .status {
      display: inline-flex; align-items: center; gap: 8px; font-weight: 600; padding: 8px 12px; border-radius: 999px;
      background: rgba(255,255,255,0.06); border: 1px solid rgba(255,255,255,0.12);
    }
    .dot { width: 10px; height: 10px; border-radius: 50%; background: var(--warn); box-shadow: 0 0 0 4px rgba(245, 158, 11, 0.15); }
    .dot.live { background: var(--ok); box-shadow: 0 0 0 4px rgba(34, 197, 94, 0.15); }

    .panel { background: var(--card); border: 1px solid rgba(255,255,255,0.08); border-radius: 16px; padding: 18px; }
    .countdown { font-variant-numeric: tabular-nums; font-size: clamp(20px, 5vw, 38px); font-weight: 800; letter-spacing: 1px; }
    .help { color: var(--muted); font-size: 13px; line-height: 1.6; }

    .qrBox { display: grid; place-items: center; aspect-ratio: 1/1; background: rgba(255,255,255,0.03); border-radius: 16px; border: 1px dashed rgba(255,255,255,0.18);}
    #qrcode, #qrcode_mirror { padding: 16px; background: white; border-radius: 12px; }
    .actions { display: flex; gap: 10px; flex-wrap: wrap; }
    .btn { cursor: pointer; border: 1px solid rgba(255,255,255,0.16); color: var(--text); background: transparent; padding: 10px 14px; border-radius: 12px; font-weight: 600; }
    .btn.primary { background: linear-gradient(90deg, var(--accent), var(--accent2)); border: none; }
    .btn:disabled { opacity: 0.6; cursor: not-allowed; }
    a.link { color: #7dd3fc; text-decoration: none; }
    .small { font-size: 12px; color: var(--muted); }
    .kbd { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; background: rgba(255,255,255,0.08); padding: 2px 6px; border-radius: 6px; }

    /* å³å´ï¼šå¤šæ®µè·¯ç·šå¡ç‰‡ */
    .routes { display: grid; grid-template-columns: 1fr; gap: 12px; }
    @media (min-width: 560px) { .routes { grid-template-columns: 1fr 1fr; } }
    .route-card {
      background: var(--card);
      border: 1px solid rgba(255,255,255,0.08);
      border-radius: 14px;
      padding: 14px;
      display: grid;
      gap: 10px;
    }
    .route-title { font-weight: 700; font-size: 16px; }

    /* æ´»å‹•èªªæ˜å¡ç‰‡ï¼ˆå¯é¸ï¼Œè®“æ–‡å­—æ›´å¥½è®€ï¼‰ */
    .intro-card p {
      margin: 0;
      line-height: 1.75;
      color: var(--muted);
      font-size: 14px;
    }
    .intro-card strong { color: var(--text); }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <div style="display:flex; justify-content:space-between; align-items:center; gap:12px; flex-wrap:wrap; margin-bottom: 12px;">
        <h1>823 æ ¸ä¸‰å»¶å½¹æŠ•åŒæ„ï½œ816å®£å‚³è»Šæƒè¡Œå‹•</h1>
        <span id="status" class="status"><span class="dot" id="dot"></span><span id="statusText">æ´»å‹•å°šæœªé–‹å§‹</span></span>
      </div>
      <div class="subtitle">æœ¬é å°‡åœ¨æ´»å‹•é–‹å§‹å¾Œï¼Œæä¾›é€£çµèˆ‡ QR Code å°å‘ Google åœ°åœ–ï¼Œå‘ˆç¾è»ŠéšŠå³æ™‚ä½ç½®/è·¯ç·šè³‡è¨Šã€‚</div>

      <div class="grid">
        <section class="panel">
          <h2 style="margin:0 0 8px; font-size:18px;">â³ å€’æ•¸èˆ‡è³‡è¨Š</h2>
          <div id="pre" style="display:grid; gap:12px;">
            <div class="countdown" id="countdown">--:--:--</div>
            <div class="help">
              æ´»å‹•é–‹å§‹æ™‚é–“ï¼š<strong id="startTxt"></strong><br/>
            </div>
          </div>

          <div id="live" style="display:none; gap:12px;">
            <div style="font-weight:700;">âœ… æ´»å‹•å·²é–‹å§‹ï¼Œè«‹æƒæä¸‹æ–¹ QR æˆ–é»æ“ŠæŒ‰éˆ•ã€‚</div>
          </div>

          <!-- æ´»å‹•èªªæ˜ï¼ˆäº‹å‰èˆ‡æ´»å‹•ä¸­éƒ½é¡¯ç¤ºï¼‰ -->
          <section class="panel intro-card" id="campaign-info" aria-live="polite">
            <h2 style="margin:0 0 8px; font-size:18px;">ğŸ“£ æ´»å‹•èªªæ˜</h2>
            <p>
              <strong>8/16 å…¨å¸‚å‡ºæ“Šï¼æ ¸ä¸‰å»¶å½¹å…¬æŠ•å®£å‚³è»Šæƒè¡Œå‹•</strong><br>
              8æœˆ16æ—¥ä¸‹åˆ2é»æ•´ï¼Œå®£å‚³è»ŠéšŠå°‡å¾æ¡ƒåœ’ç¶“åœ‹è½‰é‹ç«™å‡ºç™¼ï¼Œæ²¿é€”ç©¿è¶Šæ¡ƒåœ’ã€å…«å¾·ã€å¹³é®èˆ‡ä¸­å£¢ï¼Œé‚Šèµ°é‚Šå®£è¬›ï¼Œå‘å¸‚æ°‘å‚³é”æ ¸ä¸‰å»¶å½¹çš„é‡è¦æ€§èˆ‡ç«‹å ´ï¼Œæå‡å…¬æŠ•çŸ¥æ›‰åº¦èˆ‡æ”¯æŒåº¦ã€‚å‚æ™šæŠµé”é‡‘è»Šæ±½è»Šå¾Œï¼Œæ¥è‘—é‚€è«‹æ‚¨ä¸€èµ·å‰å¾€ä»æµ·å®®å¤œå¸‚èˆ‰ç‰Œå®£è¬›ï¼ŒæŒçºŒæ“´æ•£è²é‡ã€‚è·Ÿè‘—æˆ‘å€‘ï¼Œä¸€èµ·è®“æ ¸ä¸‰å»¶å½¹å…¬æŠ•çš„è²éŸ³éä½ˆå…¨åŸï¼
            </p>
          </section>

          <!-- å–®ä¸€çš„åˆ†äº«åˆ—ï¼ˆæ”¾åœ¨ #live èˆ‡ #left-qr-mirror ä¹‹é–“ï¼‰ -->
          <div class="actions" id="shareRow" style="margin-top:6px; margin-bottom:10px;">
            <button class="btn" id="shareBtn">åˆ†äº«æœ¬é </button>
          </div>

          <!-- å·¦å´ä¸‹åŠéƒ¨ï¼šQR å‰¯æœ¬ï¼ˆä¿ç•™å³å´åŸæœ¬å€å¡Šï¼‰ -->
          <section class="panel" aria-live="polite" id="left-qr-mirror">
            <h2 style="margin:0 0 8px; font-size:18px;">ğŸ—ºï¸ è»ŠéšŠå³æ™‚ä½ç½® QR Codeï¼ˆæ´»å‹•é–‹å§‹å¾Œå•Ÿç”¨ï¼‰</h2>
            <div class="qrBox">
              <div id="qrcode_mirror" aria-label="åœ°åœ–é€£çµ QR Codeï¼ˆå·¦å´ï¼‰"></div>
            </div>
            <div id="qrLinkWrap2" style="margin-top:10px; display:none; text-align:center;">
              <a id="qrLinkText2" class="link" href="#" target="_blank" rel="noopener">æ‰“é–‹ Google åœ°åœ–ï¼ˆè»ŠéšŠå³æ™‚ä½ç½®ï¼‰</a>
            </div>
          </section>
        </section>

        <!-- å³å´ï¼šå„æ®µè·¯ç·šå¡ç‰‡ -->
        <section class="panel">
          <h2 style="margin:0 0 8px; font-size:18px;">ğŸ“ å„æ®µè·¯ç·šå¿«é€Ÿå…¥å£</h2>
          <div class="routes">
            <div class="route-card">
              <div class="route-title">æ¡ƒåœ’æ®µè·¯ç·š</div>
              <div class="actions">
                <a id="link-taoyuan" class="btn primary" target="_blank" rel="noopener">æŸ¥çœ‹åœ°åœ–</a>
                <button class="btn" data-copy="taoyuan">è¤‡è£½é€£çµ</button>
              </div>
            </div>

            <div class="route-card">
              <div class="route-title">å…«å¾·æ®µè·¯ç·š</div>
              <div class="actions">
                <a id="link-bade" class="btn primary" target="_blank" rel="noopener">æŸ¥çœ‹åœ°åœ–</a>
                <button class="btn" data-copy="bade">è¤‡è£½é€£çµ</button>
              </div>
            </div>

            <div class="route-card">
              <div class="route-title">å¹³é®æ®µè·¯ç·š</div>
              <div class="actions">
                <a id="link-pingzhen" class="btn primary" target="_blank" rel="noopener">æŸ¥çœ‹åœ°åœ–</a>
                <button class="btn" data-copy="pingzhen">è¤‡è£½é€£çµ</button>
              </div>
            </div>

            <div class="route-card">
              <div class="route-title">ä¸­å£¢æ®µè·¯ç·š</div>
              <div class="actions">
                <a id="link-zhongli" class="btn primary" target="_blank" rel="noopener">æŸ¥çœ‹åœ°åœ–</a>
                <button class="btn" data-copy="zhongli">è¤‡è£½é€£çµ</button>
              </div>
            </div>
          </div>
        </section>
      </div>

      <div style="margin-top:14px; display:flex; justify-content:space-between; align-items:center; gap:10px; flex-wrap:wrap;">
        <div class="small">æ™‚å€ï¼šå°åŒ—ï¼ˆUTC+8ï¼‰ã€‚</div>
        <div class="small" id="nowTxt"></div>
      </div>
    </div>
  </div>

  <script>
  const DEFAULT_START = '2025-08-16T14:00:00+08:00';
  const DEFAULT_MAP   = 'https://maps.app.goo.gl/wff8JfZnGy5DNgPm7';

  // å„æ®µé è¨­è·¯ç·šï¼ˆå¯ç”¨ç¶²å€åƒæ•¸è¦†å¯«ï¼‰
  const DEFAULT_MAPS = {
    taoyuan:  'https://maps.app.goo.gl/M8yjsxH2ZF4YhTmS8?g_st=il',
    bade:     'https://maps.app.goo.gl/nKF5cGXhcsPnNh2a9?g_st=il',
    pingzhen: 'https://maps.app.goo.gl/jo75iTYiEU3Fk1bf7?g_st=il',
    zhongli:  'https://maps.app.goo.gl/twT7h7WTSPrdtjUS8?g_st=il',
  };

  const $  = (sel) => document.querySelector(sel);
  const fmt = (d) => new Intl.DateTimeFormat('zh-Hant', { dateStyle: 'medium', timeStyle: 'short', timeZone: 'Asia/Taipei'}).format(d);
  const pad = (n) => String(n).padStart(2,'0');

  function parseParams(){
    const u = new URL(location.href);
    return {
      start: u.searchParams.get('start') || DEFAULT_START,
      map:   u.searchParams.get('map')   || DEFAULT_MAP,
      routes: {
        taoyuan:  u.searchParams.get('taoyuan')  || DEFAULT_MAPS.taoyuan,
        bade:     u.searchParams.get('bade')     || DEFAULT_MAPS.bade,
        pingzhen: u.searchParams.get('pingzhen') || DEFAULT_MAPS.pingzhen,
        zhongli:  u.searchParams.get('zhongli')  || DEFAULT_MAPS.zhongli,
      }
    };
  }

  function setStatus(live){
    const dot = $('#dot');
    const txt = $('#statusText');
    if(live){ dot.classList.add('live'); txt.textContent='æ´»å‹•é€²è¡Œä¸­'; document.title='è»Šæƒå³æ™‚ä½ç½®ï½œæ´»å‹•é€²è¡Œä¸­'; }
    else    { dot.classList.remove('live'); txt.textContent='æ´»å‹•å°šæœªé–‹å§‹'; document.title='è»Šæƒå³æ™‚ä½ç½®ï½œæ´»å‹•å°šæœªé–‹å§‹'; }
  }

  function startCountdown(startAt){
    const el = $('#countdown');
    function tick(){
      const now = new Date();
      $('#nowTxt').textContent = 'ç¾åœ¨æ™‚é–“ï¼š' + fmt(now);
      const diff = startAt - now;
      if(diff <= 0){ el.textContent = '00:00:00'; return true; }
      const s  = Math.floor(diff/1000);
      const hh = pad(Math.floor(s/3600));
      const mm = pad(Math.floor((s%3600)/60));
      const ss = pad(s%60);
      el.textContent = `${hh}:${mm}:${ss}`;
      return false;
    }
    return tick;
  }

  function init(){
    const cfg = parseParams();
    const startAt = new Date(cfg.start);
    $('#startTxt').textContent = fmt(startAt);

    // å³/å·¦ QR å®¹å™¨èˆ‡é€£çµ
    const qrel        = document.getElementById('qrcode');
    const qrel2       = document.getElementById('qrcode_mirror');
    const qrLinkWrap  = document.getElementById('qrLinkWrap');
    const qrLinkText  = document.getElementById('qrLinkText');
    const qrLinkWrap2 = document.getElementById('qrLinkWrap2');
    const qrLinkText2 = document.getElementById('qrLinkText2');

    const EARLY_MS = 60 * 60 * 1000; // 1 å°æ™‚ï¼ˆæ¯«ç§’ï¼‰
    let earlyQRShown = false;        // é¿å…æ¯å¹€é‡ç•« QR

    // âœ… æ­£ç¢º QR ç”¢ç”Ÿï¼šç”¨å¤–éƒ¨æœå‹™ç”Ÿæˆ PNGï¼Œç›´æ¥æ’å…¥ <img>
    function makeQR(el, url, alt){
      const src = 'https://api.qrserver.com/v1/create-qr-code/?size=280x280&data=' + encodeURIComponent(url);
      el.innerHTML = `<img src="${src}" width="280" height="280" alt="${alt||'QR Code'}" style="display:block">`;
    }

    function renderLive(){
      setStatus(true);
      $('#pre').style.display  = 'none';
      $('#live').style.display = 'grid';
    
      const map = cfg.map;
      // $('#goMapBtn').href = map;
    
      // åªç”Ÿæˆå·¦å´ QR
      if (qrel2) makeQR(qrel2, map, 'è»ŠéšŠå³æ™‚ä½ç½® QR Codeï¼ˆå·¦å´ï¼‰');
    
      if (qrLinkText2) qrLinkText2.href = map;
      if (qrLinkWrap2) qrLinkWrap2.style.display = 'block';
    }
    
    // function renderPre(){
    //   setStatus(false);
    //   $('#pre').style.display  = 'grid';
    //   $('#live').style.display = 'none';
    //   if (qrel2) qrel2.innerHTML = '<div style="color:#9fb0d9; padding:6px;">æ´»å‹•é–‹å§‹å¾Œè‡ªå‹•é¡¯ç¤º QR Code</div>';
    //   if (qrLinkWrap2) qrLinkWrap2.style.display = 'none';
    // }
    function renderPre(diffMs){
      setStatus(false);
      $('#pre').style.display  = 'grid';
      $('#live').style.display = 'none';

      if (!qrel2) return; // ä¿è­·

      // è‹¥è·é›¢é–‹å§‹ <= 1 å°æ™‚ï¼šæå‰é¡¯ç¤º QRï¼›å¦å‰‡é¡¯ç¤ºå ä½
      if (diffMs <= EARLY_MS) {
        if (!earlyQRShown) {
          makeQR(qrel2, cfg.map, 'è»ŠéšŠå³æ™‚ä½ç½® QR Codeï¼ˆé é–‹æ”¾ï¼‰');
          if (qrLinkText2) qrLinkText2.href = cfg.map;
          if (qrLinkWrap2) qrLinkWrap2.style.display = 'block';
          earlyQRShown = true;
        }
      } else {
        if (earlyQRShown) {
          // å›åˆ°ä¸€èˆ¬å ä½ç‹€æ…‹
          qrel2.innerHTML = '<div style="color:#9fb0d9; padding:6px;">æ´»å‹•é–‹å§‹å¾Œè‡ªå‹•é¡¯ç¤º QR Code</div>';
          if (qrLinkWrap2) qrLinkWrap2.style.display = 'none';
          earlyQRShown = false;
        } else {
          // åˆå§‹é€²ä¾†ä¹Ÿè¦æœ‰å ä½
          qrel2.innerHTML = '<div style="color:#9fb0d9; padding:6px;">æ´»å‹•é–‹å§‹å¾Œè‡ªå‹•é¡¯ç¤º QR Code</div>';
          if (qrLinkWrap2) qrLinkWrap2.style.display = 'none';
        }
      }
    }

    // // å€’æ•¸ï¼ˆæ²¿ç”¨ä½ åŸæœ¬çš„ rAF ç‰ˆæœ¬ï¼‰
    // const tick = startCountdown(startAt);
    // function loop(){
    //   const isPassed = tick();
    //   if (isPassed) renderLive();
    //   else { renderPre(); requestAnimationFrame(loop); }
    // }
    // loop();
    // å€’æ•¸ï¼ˆæ²¿ç”¨ä½ åŸæœ¬çš„ rAF ç‰ˆæœ¬ï¼‰
    const tick = startCountdown(startAt);
    function loop(){
      const isPassed = tick();
      const diff = startAt - new Date(); // å‰©é¤˜æ¯«ç§’ï¼ˆå¯èƒ½ç‚ºè² ï¼‰

      if (isPassed) {
        renderLive();         // åˆ°é»åˆ‡æˆ liveï¼šä»ç”¨ä½ åŸæœ¬çš„æµç¨‹
        return;               // live ä¸å† rAF
      } else {
        renderPre(diff);      // äº‹å‰ or é é–‹æ”¾ï¼ˆ<=1hrï¼‰éƒ½èµ°é€™è£¡
        requestAnimationFrame(loop);
      }
    }
    loop();

    // å³å´å¡ç‰‡ï¼šå¡«å…¥é€£çµèˆ‡è¤‡è£½
    const routeMap = cfg.routes;
    [
      ['taoyuan','link-taoyuan'],
      ['bade','link-bade'],
      ['pingzhen','link-pingzhen'],
      ['zhongli','link-zhongli'],
    ].forEach(([key, anchorId])=>{
      const a = document.getElementById(anchorId);
      if (a) a.href = routeMap[key];
      const copyBtn = document.querySelector(`[data-copy="${key}"]`);
      if (copyBtn){
        copyBtn.addEventListener('click', async()=>{
          try { await navigator.clipboard.writeText(routeMap[key]); alert('é€£çµå·²è¤‡è£½'); }
          catch { alert('è¤‡è£½å¤±æ•—'); }
        });
      }
    });

    // Actions
    $('#shareBtn').addEventListener('click', async()=>{
      const data = { title: document.title, text: 'è»Šæƒå³æ™‚ä½ç½®é é¢', url: location.href };
      try{ if(navigator.share){ await navigator.share(data); }
           else { await navigator.clipboard.writeText(location.href); alert('å·²è¤‡è£½æœ¬é ç¶²å€ï¼Œå¯è²¼åˆ°ç¾¤çµ„'); } }
      catch(e){}
    });
  }

  document.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>
